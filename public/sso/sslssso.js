function Observable(){this.listen=function(t,e,n,o){var i,a;(i=this.listeners)||(i=this.listeners={}),(a=i[t])||(a=i[t]=[]),n=n||window,a.push({method:e,scope:n,context:o||n})},this.fireEvent=function(t,e,n){var o,i,a,s,c;if((o=this.listeners)&&(i=o[t])){for(a=0,s=i.length;a<s;a++)if(c=i[a],(void 0===n||n===c.context)&&!1===c.method.call(c.scope,this,t,e))return!1;return!0}}}function _getAPIKEY(){return _getMetaData("sso_smsc_apikey")?_getMetaData("sso_smsc_apikey"):"undefined"!=typeof ssls_accountId&&ssls_accountId?ssls_accountId:null}function _getMetaData(t){for(var e=document.getElementsByTagName("meta"),n=0;n<e.length;n++)if(e[n].getAttribute("name")==t)return e[n].getAttribute("content");return null}function displayLogin(){var t=_getAPIKEY(),e=window.location.href;redirect(""===e||void 0===e?"//bgt.tinhvan.com/sso/authenticate?apiKey="+t+"&callback=demo_html":"/sso/authenticate?apiKey="+t+"&callback="+e)}function redirect(t){navigator.userAgent.match(/Android/i)?document.location=t:window.location.replace(t)}function PopupCenter(t,e,n,o){var i=null!=window.screenLeft?window.screenLeft:window.screenX,a=null!=window.screenTop?window.screenTop:window.screenY,s=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-n/2+i,c=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-o/2+a,l=window.open(t,e,"scrollbars=yes, width="+n+", height="+o+", top="+c+", left="+s);window.focus&&l.focus()}sslssso=new sslssso;var console=window.console||{log:function(){}};function sslssso(){var DEFAULT_IFRAME_URI="html/sso.html",obs=new Observable,config={};function _getMeta(t){for(var e=document.getElementsByTagName("meta"),n=0;n<e.length;n++)if(e[n].getAttribute("name")==t)return e[n].getAttribute("content");return null}function _getAccountId(){return config.accountId?config.accountId:_getMeta("sso_smsc_apikey")?_getMeta("sso_smsc_apikey"):"undefined"!=typeof ssls_accountId&&ssls_accountId?ssls_accountId:null}function _getValidationUrl(){return config.validationUrl?config.validationUrl:_getMeta("ssls.validationUrl")?_getMeta("ssls.validationUrl"):"undefined"!=typeof ssls_validationUrl&&ssls_validationUrl?ssls_validationUrl:null}function _getValidate(){return config.validate?config.validate:_getMeta("ssls.validate")?_getMeta("ssls.validate"):null}this.listen=function(t,e,n,o){obs.listen(t,e,n,o)},this.logout=function(){postSSOMessage({action:"logout"},_getUrl())},this.login=function(t){postSSOMessage({action:"login",jwt:t},_getUrl())},this.testLoginSafari=function(){postSSOMessage("You are clicked login!!!","*")};var _getScriptURL=(scripts=document.getElementsByTagName("script"),myScript=scripts[scripts.length-1],function(){return myScript.src}),scripts,myScript;function _getIframeUrl(){var t=document.createElement("a");t.href=_getScriptURL();t.pathname.substring(0,t.pathname.lastIndexOf("/"));var e=t.protocol+"//"+t.host+"/"+DEFAULT_IFRAME_URI,n=document.location.origin,o=_getAccountId(),i=_getValidationUrl(),a=_getValidate();return e=e+"?domain="+n,o&&(e=e+"&accountId="+o),i&&(e=e+"&validationUrl="+i),null!=a&&(e=e+"&validate="+a),e}function _getUrl(){var t=document.createElement("a");return t.href=_getScriptURL(),t.protocol+"//"+t.host}function postSSOMessage(t,e){var n=document.getElementById("ssls.sso.iframe").contentWindow;window.attachEvent?n.postMessage(JSON.stringify(t),"*"):n.postMessage(t,_getUrl())}function dispatchEvent(t,e){obs.fireEvent(t,e)}function _listener(event){if(-1!=_getUrl().lastIndexOf(event.origin)){var data=event.data;event.data&&!event.data.action&&(data=eval("("+event.data+")")),data&&"sso.onlogout"==data.action?("function"==typeof onLogout&&onLogout(),dispatchEvent("sso.onlogout")):data&&"sso.onload"==data.action?("function"==typeof onLoad&&onLoad(),dispatchEvent("sso.onload")):data&&"sso.onidentification"==data.action&&("function"==typeof onIdentification&&onIdentification(data),dispatchEvent("sso.onidentification",data))}}function _init(){_getAccountId();window.addEventListener?addEventListener("message",_listener,!1):attachEvent("onmessage",_listener);var t=_getIframeUrl(),e=document.createElement("iframe");e.style.display="none",e.id="ssls.sso.iframe",e.src=t,document.body.appendChild(e)}function init(t){t&&(config=t)}window.addEventListener?window.addEventListener("load",_init):window.attachEvent&&window.attachEvent("onload",_init)}
